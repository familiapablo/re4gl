<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta name="robots" content="noindex, nofollow">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Fortzone Battle Royale</title>
  <link rel="stylesheet" href="TemplateData/style.css">

  <script>
    const overlayBackgroundColor = "#555555";
    const progressBarFillColor = "#f76426";
    const progressBarBackgroundColor = "#000000";
    const progressBarBorderColor = "#000000";
  </script>

</head>

<body class="light">
  <div id="unity-container" class="unity-desktop">
    <canvas id="unity-canvas"></canvas>
  </div>
  <div id="loading-cover" style="display:none;">
    <div id="unity-loading-bar">
      <div id="unity-logo"><img src="logo.png"></div>
      <div id="unity-progress-bar-empty" style="display: none;">
        <div id="unity-progress-bar-full"></div>
      </div>
      <div class="spinner"></div>
    </div>
  </div>

  <script>
    const buildUrl = "Build";
    const loaderUrl = buildUrl + "/FortzoneWebGL109.loader.js";
    // Orijinal dataUrl pasif hale getirildi - bölünen partlar ile değiştirildi
    // const config = {
    //   dataUrl: buildUrl + "/FortzoneWebGL109.data.unityweb",
    //   frameworkUrl: buildUrl + "/FortzoneWebGL109.framework.js.unityweb",
    //   codeUrl: buildUrl + "/FortzoneWebGL109.wasm.unityweb",
    //   streamingAssetsUrl: "StreamingAssets",
    //   companyName: "Fahrenheit Dev",
    //   productName: "Fortzone Battle Royale",
    //   productVersion: "0.8.8",
    // };
    const config = {
      // dataUrl buraya dinamik olarak atanacak
      frameworkUrl: buildUrl + "/FortzoneWebGL109.framework.js.unityweb",
      codeUrl: buildUrl + "/FortzoneWebGL109.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "Fahrenheit Dev",
      productName: "Fortzone Battle Royale",
      productVersion: "0.8.8",
    };

    const container = document.querySelector("#unity-container");
    const canvas = document.querySelector("#unity-canvas");
    const loadingCover = document.querySelector("#loading-cover");
    const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
    const progressBarFull = document.querySelector("#unity-progress-bar-full");
    const spinner = document.querySelector('.spinner');

    if (overlayBackgroundColor !== "-" && overlayBackgroundColor !== " " && overlayBackgroundColor !== "")
      canvas.style.background = overlayBackgroundColor;

    if (progressBarFillColor !== "-" && progressBarFillColor !== " " && progressBarFillColor !== "")
      progressBarFull.style.background = progressBarFillColor;

    if (progressBarBackgroundColor !== "-" && progressBarBackgroundColor !== " " && progressBarBackgroundColor !== "")
      progressBarEmpty.style.background = progressBarBackgroundColor;

    if (progressBarBorderColor !== "-" && progressBarBorderColor !== " " && progressBarBorderColor !== "")
      progressBarEmpty.style.border.color = progressBarBorderColor;


    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
      container.className = "unity-mobile";
    }

    loadingCover.style.display = "";

    const unityLoader = document.createElement("script");
    unityLoader.src = loaderUrl;
    unityLoader.onload = async () => {
      // Bölünen 4 part'ı yükle ve birleştir
      const partCount = 4;
      const parts = [];
      for (let i = 1; i <= partCount; i++) {
        const partUrl = buildUrl + `/FortzoneWebGL109.data_part${i}.unityweb`;
        try {
          const response = await fetch(partUrl);
          if (!response.ok) {
            throw new Error(`Part ${i} yüklenemedi: ${response.statusText}`);
          }
          const arrayBuffer = await response.arrayBuffer();
          parts.push(arrayBuffer);
          console.log(`Part ${i} yüklendi: ${arrayBuffer.byteLength} byte`);
        } catch (error) {
          console.error(error);
          alert(`Hata: ${error.message}`);
          return;
        }
      }

      // ArrayBuffer'ları birleştir
      let totalLength = 0;
      for (let ab of parts) {
        totalLength += ab.byteLength;
      }
      const merged = new Uint8Array(totalLength);
      let offset = 0;
      for (let ab of parts) {
        merged.set(new Uint8Array(ab), offset);
        offset += ab.byteLength;
      }

      // Blob oluştur ve URL üret
      const blob = new Blob([merged], { type: 'application/octet-stream' });
      const dataUrl = URL.createObjectURL(blob);
      config.dataUrl = dataUrl;

      console.log(`Birleştirme tamamlandı. Toplam boyut: ${totalLength} byte`);

      // Unity instance'ı oluştur
      createUnityInstance(canvas, config, (progress) => {
        spinner.style.display = "none";
        progressBarEmpty.style.display = "";
        progressBarFull.style.width = `${100 * progress}%`;
      }).then((unityInstance) => {
        window.unityInstance = unityInstance;
        loadingCover.style.display = "none";
      }).catch((message) => {
        alert(message);
      });
    };
    document.body.appendChild(unityLoader);

    document.addEventListener("pointerdown", () => {
      container.focus();
      window.focus();
      canvas.focus();
    });

  </script>
<!-- Sticky Bottom Center Ad (728x90) with Smooth Slide-Out and Reappearance -->
<style>
  /* Container: Bottom center, fixed, with overflow hidden */
  #ad-container {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: min(728px, calc(100% - 20px)); /* 728px, 10px margin on mobile */
    height: 90px;
    background: rgba(0, 0, 0, 0.90);
    display: none;
    z-index: 99999;
    border-radius: 0; /* Sharp corners */
    overflow: hidden;
    box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.45);
    box-sizing: border-box;
    transition: transform 0.5s ease-in-out; /* Smooth slide-in/out animation */
  }

  /* Slide-out animation */
  #ad-container.hidden {
    transform: translate(-50%, 100%); /* Slide down out of view */
  }

  #ad-iframe {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 745px; /* Updated width */
    height: 90px; /* Updated height */
    border: 0;
    display: block;
    overflow: hidden;
    pointer-events: auto;
    box-sizing: content-box;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  #ad-iframe::-webkit-scrollbar {
    display: none;
    width: 0;
    height: 0;
  }

  /* Right mask for scrollbar */
  #ad-right-mask {
    position: absolute;
    top: 0;
    right: 0;
    width: 12px;
    height: 100%;
    pointer-events: none;
    background: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.9));
    z-index: 99999;
  }

  /* Mobile adjustments */
  @media (max-width: 440px) {
    #ad-container {
      width: calc(100% - 12px);
      left: 50%;
      transform: translateX(-50%);
      border-radius: 0; /* Sharp corners on mobile */
    }
    #ad-iframe {
      width: 728px;
    }
  }
</style>

<div id="ad-container" aria-hidden="true" role="dialog" aria-label="Advertisement">
  <iframe
    id="ad-iframe"
    src="https://script.google.com/macros/s/AKfycbwO0_-Mbrs-AoE1MqbBxyaIzK385M7xGx4jDkq-FDsbR9wNcqft1m3554Np5XINfbRViw/exec"
    width="768px"
    height="95px"
    scrolling="no"
    frameborder="0"
    sandbox="allow-scripts allow-popups allow-same-origin"
  ></iframe>
  <div id="ad-right-mask"></div>
</div>

<script>
  (function () {
    const showDelay = 2000; // 2 seconds delay before first show
    const adContainer = document.getElementById('ad-container');

    function showAd() {
      // Show ad with smooth slide-in
      adContainer.style.display = 'block';
      adContainer.classList.remove('hidden');
      adContainer.setAttribute('aria-hidden', 'false');
    }

    // Initial ad show
    setTimeout(showAd, showDelay);
  })();
</script>


</body>

</html>